<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil de Usuario - MoviesWeb</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Variables de color en l√≠nea */
        :root {
            --bg: #ffffff;
            --bg-soft: #f5f6f8;
            --text: #111111;
            --muted: #555555;
            --card: #ffffff;
            --border: #e5e7eb;
            --link: #0a66c2;
            --accent: #4f46e5;
        }

        :root.dark {
            --bg: #0b0f16;
            --bg-soft: #0f1520;
            --text: #e6e6e6;
            --muted: #a1a1aa;
            --card: #0d1117;
            --border: #1f2937;
            --link: #7aa2f7;
            --accent: #8b5cf6;
        }

        html {
            background-color: var(--bg);
            color: var(--text);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--bg);
            color: var(--text);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }

        h1 {
            font-size: 2rem;
            color: var(--text);
        }

        h2 {
            color: var(--text);
        }

        /* Bot√≥n de tema */
        .theme-toggle {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background-color: var(--card);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 999px;
            cursor: pointer;
            user-select: none;
            transition: opacity 0.2s;
        }

        .theme-toggle:hover {
            opacity: 0.8;
        }

        .theme-toggle .dot {
            width: 0.8rem;
            height: 0.8rem;
            border-radius: 999px;
            background-color: var(--accent);
            transition: transform 0.2s ease;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--muted);
            font-size: 0.9rem;
        }

        .timeline {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 30px;
        }

        .timeline h2 {
            margin-bottom: 25px;
            font-size: 1.5rem;
        }

        .activity-item {
            display: flex;
            gap: 15px;
            padding: 20px;
            border-left: 3px solid var(--accent);
            background: var(--bg-soft);
            border-radius: 8px;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }

        .activity-item:hover {
            transform: translateX(5px);
        }

        .activity-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 1rem;
            margin-bottom: 5px;
            color: var(--text);
        }

        .activity-movie {
            font-weight: bold;
            color: var(--accent);
        }

        .activity-time {
            font-size: 0.85rem;
            color: var(--muted);
        }

        .activity-rating {
            color: #fbbf24;
            font-weight: bold;
        }

        .activity-review {
            margin-top: 10px;
            padding: 10px;
            background: var(--bg);
            border-radius: 6px;
            font-style: italic;
            color: var(--muted);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .btn-back {
            display: inline-block;
            padding: 10px 20px;
            background: var(--accent);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: opacity 0.2s;
            margin-top: 20px;
        }

        .btn-back:hover {
            opacity: 0.8;
        }

        p {
            color: var(--text);
        }

        span {
            color: var(--text);
        }

        div {
            color: var(--text);
        }
    </style>
</head>
<body>

<div class="header">
    <h1>üë§ Perfil de <%= userId %></h1>
    <div>
        <button id="theme-toggle" class="theme-toggle" type="button" title="Cambiar tema">
            <span class="dot" aria-hidden="true"></span>
            <span id="theme-toggle-label">Dark</span>
        </button>
    </div>
</div>

<div class="stats">
    <div class="stat-card">
        <div class="stat-number"><%= stats.totalRatings %></div>
        <div class="stat-label">Calificaciones</div>
    </div>
    <div class="stat-card">
        <div class="stat-number"><%= stats.totalReviews %></div>
        <div class="stat-label">Rese√±as</div>
    </div>
    <div class="stat-card">
        <div class="stat-number"><%= stats.totalFavorites %></div>
        <div class="stat-label">Favoritos</div>
    </div>
</div>

<div class="timeline">
    <h2>üìÖ Actividad Reciente</h2>

    <% if (timeline && timeline.length > 0) { %>
        <% timeline.forEach(activity => { %>
            <div class="activity-item">
                <div class="activity-icon">
                    <% if (activity.type === 'RATED_MOVIE') { %>‚≠ê
                    <% } else if (activity.type === 'WROTE_REVIEW') { %>‚úçÔ∏è
                    <% } else { %>‚ù§Ô∏è<% } %>
                </div>

                <div class="activity-content">
                    <div class="activity-text">
                        <% if (activity.type === 'RATED_MOVIE') { %>
                            Calific√≥ <span class="activity-movie"><%= activity.details.movieTitle %></span>
                            con <span class="activity-rating"><%= activity.details.rating %> estrellas</span>
                        <% } else if (activity.type === 'WROTE_REVIEW') { %>
                            Escribi√≥ una rese√±a para <span class="activity-movie"><%= activity.details.movieTitle %></span>
                        <% } else { %>
                            A√±adi√≥ <span class="activity-movie"><%= activity.details.movieTitle %></span> a favoritos
                        <% } %>
                    </div>

                    <div class="activity-time">
                        <%= new Date(activity.timestamp).toLocaleString('es-ES', {
                            dateStyle: 'medium',
                            timeStyle: 'short'
                        }) %>
                    </div>

                    <% if (activity.type === 'WROTE_REVIEW' && activity.details.reviewText) { %>
                        <div class="activity-review">"<%= activity.details.reviewText %>"</div>
                    <% } %>
                </div>
            </div>
        <% }) %>
    <% } else { %>
        <div class="empty-state">
            <div class="empty-state-icon">üì≠</div>
            <p>No hay actividad registrada a√∫n</p>
            <p style="margin-top: 10px;">
                <a href="/" class="btn-back">Explorar pel√≠culas</a>
            </p>
        </div>
    <% } %>
</div>

<script>
    // Sistema de tema claro/oscuro
    (function(){
        const KEY = 'theme';

        function apply(theme){
            const r = document.documentElement;
            theme === 'dark' ? r.classList.add('dark') : r.classList.remove('dark');
        }

        function initial(){
            const saved = localStorage.getItem(KEY);
            if(saved === 'dark' || saved === 'light') return saved;
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function label(theme){
            const el = document.getElementById('theme-toggle-label');
            if(el) el.textContent = theme === 'dark' ? 'Light' : 'Dark';
            const dot = document.querySelector('.theme-toggle .dot');
            if(dot) dot.style.transform = theme === 'dark' ? 'translateX(12px)' : 'translateX(0)';
        }

        function toggle(){
            const next = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
            apply(next);
            localStorage.setItem(KEY, next);
            label(next);
        }

        const init = initial();
        apply(init);

        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('theme-toggle');
            if(btn) btn.addEventListener('click', toggle);
            label(init);
        });
    })();
</script>
</body>
</html>